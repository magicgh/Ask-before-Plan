import os, sys
sys.path.append(os.path.join(os.path.dirname(__file__)))
from collections import defaultdict
from template import tool_description
ask_prompts = defaultdict(dict)

null_tips = " Note that if the user does not specify details regarding accommodation, cuisine, or transportation in the initial query, it indicates that the user does not have specific preferences that need clarification in the following conversation."
ask_prompts["direct"]["system"] = f"""Your current task is to determine the user's intentions and satisfy their needs based on the provided conversation between the user and the assistant, along with the interaction trajectory involving tool use between the agent and the environment. The interaction trajectory includes the following tools:

{tool_description}

If certain tools are not called in the interaction trajectory, it indicates a lack of the required parameters needed to call those tools. For each category, including accommodations, dining, attractions, transportation, and budget, at least one relevant tool should be used during the interaction to gather sufficient information to help the user provide a clear and feasible request.""" + null_tips

ask_prompts["direct"]["neg_example_user"] = "##### Example 1\n\nConversation: [{'user': 'We are planning a 7-day trip for 2 individuals starting from Salt Lake City. Our itinerary includes visiting San Diego on day 1, San Luis Obispo on day 3, and Los Angeles on day 5. We are set to depart on March 25th, 2022, and our budget is $4600. We prefer shared room accommodations that allow children under 10. Additionally, we will not be self-driving during our journey.'}, {'assistant': \"It seems like the accommodation preference you've specified may not be feasible for this trip. Is there a different type of accommodation you would consider, or any other preferences you could share to help tailor the travel plan accordingly?\"}, {'user': \"I'm open to a private room and smoking allowed.\"}]\nInteraction trajectory: {'AccommodationSearch(\"San Diego\", [\"private room\", \"smoking\"])': 'NAME  price    room type              house_rules  minimum nights  maximum occupancy  review rate number      city\\nSpacious Room in Large 2 Bedroom Prewar Apartment  585.0 Private room No parties & No visitors             1.0                  2                 4.0 San Diego\\n  LargeBedroom gem in historic Red Hook Brooklyn!  787.0 Private room              No visitors             4.0                  2                 3.0 San Diego\\n...', 'RestaurantSearch(\"San Diego\", [])': 'Name  Average Cost                       Cuisines  Aggregate Rating      City\\n          Open Yard            33 Chinese, Pizza, Cafe, Desserts               3.3 San Diego\\nJetha Lal Ka Dhabha            22     Tea, Cafe, Indian, Italian               3.1 San Diego\\n    The Lost Mughal            74             Tea, Cafe, Italian               3.8 San Diego\\n...', 'AttractionSearch(\"San Diego\")': 'Name  Latitude   Longitude                                                   Address          Phone                                            Website      City\\nCabrillo National Monument 32.672256 -117.241609       1800 Cabrillo Memorial Dr, San Diego, CA 92106, USA (619) 523-4285                 https://www.nps.gov/cabr/index.htm San Diego\\n      La Jolla Shores Park 32.858154 -117.256103              8300 Camino Del Oro, La Jolla, CA 92037, USA (619) 221-8899 https://www.sandiego.gov/lifeguards/beaches/shores San Diego\\n          California Tower 32.731609 -117.152167 California Tower, 1350 El Prado, San Diego, CA 92101, USA (619) 239-2001  https://museumofus.org/exhibits/california-tower/ San Diego\\n...', 'AccommodationSearch(\"San Luis Obispo\", [\"private room\", \"smoking\"])': 'NAME  price    room type                        house_rules  minimum nights  maximum occupancy  review rate number            city\\nExperiencing Tranquility in Private Home, Room # 1  111.0 Private room No visitors & No children under 10             2.0                  1                 2.0 San Luis Obispo\\n     Sunny, Newly Renovated, Private Bushwick Room  438.0 Private room                        No visitors             1.0                  1                 2.0 San Luis Obispo\\n         Williamsburg large and sunny private room  579.0 Private room               No children under 10             7.0                  2                 3.0 San Luis Obispo\\n...', 'RestaurantSearch(\"San Luis Obispo\", [])': 'Name  Average Cost                                   Cuisines  Aggregate Rating            City\\n                             Ooma            88 Desserts, Fast Food, Cafe, Indian, Seafood               4.9 San Luis Obispo\\n                     Sushi Leblon            38    French, BBQ, Fast Food, Indian, Seafood               4.6 San Luis Obispo\\nEl Jalisciense Mexican Restaurant            34            Cafe, Pizza, American, Desserts               4.1 San Luis Obispo\\n...', 'AttractionSearch(\"San Luis Obispo\")': \"Name  Latitude   Longitude                                                Address          Phone                                                                             Website            City\\nSan Luis Obispo Children's Museum 35.278988 -120.666190         1010 Nipomo St, San Luis Obispo, CA 93401, USA (805) 544-5437                                                               http://www.slocm.org/ San Luis Obispo\\n                    Mission Plaza 35.279832 -120.664751          989 Chorro St, San Luis Obispo, CA 93401, USA (805) 781-7067 https://www.slocity.org/Home/Components/FacilityDirectory/FacilityDirectory/12/2170 San Luis Obispo\\n  San Luis Obispo Railroad Museum 35.273303 -120.655673 1940 Santa Barbara Ave, San Luis Obispo, CA 93401, USA (805) 548-1894                                                              http://www.slorrm.com/ San Luis Obispo\\n...\", 'AccommodationSearch(\"Los Angeles\", [\"private room\", \"smoking\"])': 'NAME  price    room type          house_rules  minimum nights  maximum occupancy  review rate number        city\\nSunny apartment with easy connections to anywhere.  968.0 Private room No children under 10             3.0                  1                 4.0 Los Angeles\\n                     Room in Queens, NY, near LGA.  982.0 Private room No children under 10             1.0                  2                 2.0 Los Angeles\\n                                        Best Nest.  371.0 Private room              No pets             1.0                  2                 4.0 Los Angeles\\n...', 'RestaurantSearch(\"Los Angeles\", [])': 'Name  Average Cost                                       Cuisines  Aggregate Rating        City\\nHeat - Edsa Shangri-La           148                                    Bakery, BBQ               4.4 Los Angeles\\n             Palmshore            25 Desserts, Bakery, Fast Food, American, Seafood               4.3 Los Angeles\\n         Punjabi Zaika            46               Pizza, Bakery, BBQ, Cafe, Indian               3.2 Los Angeles\\n...', 'AttractionSearch(\"Los Angeles\")': 'Name  Latitude   Longitude                                                  Address          Phone                       Website        City\\n     Santa Monica Pier 34.008282 -118.498758       200 Santa Monica Pier, Santa Monica, CA 90401, USA (310) 458-8900  https://santamonicapier.org/ Los Angeles\\nHollywood Walk of Fame 34.101634 -118.326705 Hollywood Boulevard, Vine St, Los Angeles, CA 90028, USA (323) 469-8311       https://walkoffame.com/ Los Angeles\\n        Hollywood Sign 34.134115 -118.321548                               Los Angeles, CA 90068, USA (323) 258-4338 http://www.hollywoodsign.org/ Los Angeles\\n...', 'DistanceMatrix(\"Salt Lake City\", \"San Diego\", \"taxi\")': 'taxi, from Salt Lake City to San Diego, duration: 10 hours 48 mins, distance: 1,207 km, cost: 1207', 'FlightSearch(\"Salt Lake City\", \"San Diego\", \"2022-03-25\")': 'Flight Number  Price DepTime ArrTime  ActualElapsedTime FlightDate OriginCityName DestCityName  Distance\\n     F3499966    300   08:02   08:55 1 hours 53 minutes 2022-03-25 Salt Lake City    San Diego     626.0\\n     F3523821    171   11:36   12:19 1 hours 43 minutes 2022-03-25 Salt Lake City    San Diego     626.0\\n     F3539488    223   22:46   23:31 1 hours 45 minutes 2022-03-25 Salt Lake City    San Diego     626.0\\n...', 'DistanceMatrix(\"San Diego\", \"San Luis Obispo\", \"taxi\")': 'taxi, from San Diego to San Luis Obispo, duration: 4 hours 59 mins, distance: 502 km, cost: 502', 'FlightSearch(\"San Diego\", \"San Luis Obispo\", \"2022-03-27\")': 'Flight Number  Price DepTime ArrTime ActualElapsedTime FlightDate OriginCityName    DestCityName  Distance\\n     F3820181     76   09:59   11:02 1 hours 3 minutes 2022-03-27      San Diego San Luis Obispo     263.0\\n...', 'DistanceMatrix(\"San Luis Obispo\", \"Los Angeles\", \"taxi\")': 'taxi, from San Luis Obispo to Los Angeles, duration: 3 hours 14 mins, distance: 304 km, cost: 304', 'FlightSearch(\"San Luis Obispo\", \"Los Angeles\", \"2022-03-29\")': 'Flight Number  Price DepTime ArrTime ActualElapsedTime FlightDate  OriginCityName DestCityName  Distance\\n     F3854130     53   05:53   06:55 1 hours 2 minutes 2022-03-29 San Luis Obispo  Los Angeles     156.0\\n...', 'DistanceMatrix(\"Los Angeles\", \"Salt Lake City\", \"taxi\")': 'taxi, from Los Angeles to Salt Lake City, duration: 9 hours 53 mins, distance: 1,108 km, cost: 1108', 'FlightSearch(\"Los Angeles\", \"Salt Lake City\", \"2022-03-31\")': 'Flight Number  Price DepTime ArrTime  ActualElapsedTime FlightDate OriginCityName   DestCityName  Distance\\n     F3528613    214   11:14   13:55 1 hours 41 minutes 2022-03-31    Los Angeles Salt Lake City     590.0\\n     F3530430    265   13:44   16:33 1 hours 49 minutes 2022-03-31    Los Angeles Salt Lake City     590.0\\n     F3530806    283   09:45   12:28 1 hours 43 minutes 2022-03-31    Los Angeles Salt Lake City     590.0\\n...', 'BudgetEstimator(\"Salt Lake City\", [\"San Diego\", \"San Luis Obispo\", \"Los Angeles\"], [\"2022-03-25\", \"2022-03-27\", \"2022-03-29\", \"2022-03-31\"], 2)': '$1,837'}\nPlease determine whether the user's request needs clarification. A request needs clarification if the user's intention contains missing or unfeasible details based on the tool parameters and call results in the interaction trajectory. If the user's intention requires clarification, answer \"Yes\"; if it is clear and feasible, answer \"No\".\nAnswer:"
ask_prompts["direct"]["neg_example_agent"] = "No.\n\n"

ask_prompts["direct"]["pos_example_user"] = "##### Example 2\n\nConversation: [{'user': 'Create a travel plan for a group of 7 departing from Washington on March 23rd, 2022. The itinerary includes visiting Buffalo on day 1 and New York on day 3. We are looking for accommodations with an entire room setup. Our culinary preferences encompass American, Mexican, Chinese, and Italian cuisines. Additionally, we prefer not to self-drive during our journey, and our budget is set at $9100.'}]\nInteraction trajectory: {'AccommodationSearch(\"Buffalo\", [\"entire room\"])': 'NAME  price       room type                       house_rules  minimum nights  maximum occupancy  review rate number    city\\n        Cozy Studio in Heart of Ft Greene  200.0 Entire home/apt    No pets & No children under 10             4.0                  3                 5.0 Buffalo\\n          Williamsburg Gem: Sleep up to 5  486.0 Entire home/apt No smoking & No children under 10             2.0                  4                 1.0 Buffalo\\nIdeal 3 Bedroom Apartment by Times Square  297.0 Entire home/apt              No children under 10             2.0                  2                 2.0 Buffalo\\n...', 'RestaurantSearch(\"Buffalo\", [\"American\", \"Mexican\", \"Chinese\", \"Italian\"])': \"Name  Average Cost                                    Cuisines  Aggregate Rating    City\\n                  Shokitini            41 Tea, Cafe, Pizza, Mexican, Chinese, Seafood               4.2 Buffalo\\nTibby's New Orleans Kitchen            48               Seafood, Indian, BBQ, Italian               4.7 Buffalo\\n             Pinch Of Spice            84                     Cafe, Desserts, Seafood               4.2 Buffalo\\n...\", 'AttractionSearch(\"Buffalo\")': 'Name  Latitude  Longitude                                     Address          Phone                         Website    City\\n                          The Buffalo Zoo 42.937123 -78.851609    300 Parkside Ave, Buffalo, NY 14214, USA (716) 837-3900      http://www.buffalozoo.org/ Buffalo\\nBuffalo and Erie County Botanical Gardens 42.827864 -78.823995 2655 South Park Ave, Buffalo, NY 14218, USA (716) 827-1584 https://www.buffalogardens.com/ Buffalo\\n                   Buffalo AKG Art Museum 42.932450 -78.875618    1285 Elmwood Ave, Buffalo, NY 14222, USA (716) 882-8700         https://buffaloakg.org/ Buffalo\\n...', 'AccommodationSearch(\"New York\", [\"entire room\"])': 'NAME  price       room type                                  house_rules  minimum nights  maximum occupancy  review rate number     city\\nA Contemporary Homelike Stay in the Best of BK  228.0 Entire home/apt No pets & No visitors & No children under 10             2.0                  2                 2.0 New York\\n     Cool Downtown Apartment in Great Location  997.0 Entire home/apt                                      No pets             4.0                  7                 4.0 New York\\n   Magical rowhouse and garden in Williamsburg  189.0 Entire home/apt                                   No parties             4.0                  3                 1.0 New York\\n...', 'RestaurantSearch(\"New York\", [\"American\", \"Mexican\", \"Chinese\", \"Italian\"])': 'Name  Average Cost                           Cuisines  Aggregate Rating     City\\nSeasons 52 Fresh Grill            30 Seafood, Indian, Desserts, Italian               4.4 New York\\n        Gurgaon Hights            46  Cafe, American, Indian, Fast Food               2.5 New York\\n                 G Dot            75                 Cafe, Mexican, BBQ               2.4 New York\\n...', 'AttractionSearch(\"New York\")': 'Name  Latitude  Longitude                                       Address          Phone                                                                         Website     City\\n      Top of The Rock 40.759350 -73.979409 30 Rockefeller Plaza, New York, NY 10112, USA (212) 698-2000 https://www.rockefellercenter.com/attractions/top-of-the-rock-observation-deck/ New York\\nOne World Observatory 40.713006 -74.013173          117 West St, New York, NY 10007, USA (844) 696-1776                                                https://oneworldobservatory.com/ New York\\nSUMMIT One Vanderbilt 40.752764 -73.978746         45 E 42nd St, New York, NY 10017, USA        Unknown                                                        http://www.summitov.com/ New York\\n...', 'DistanceMatrix(\"Washington\", \"Buffalo\", \"taxi\")': 'taxi, from Washington to Buffalo, duration: 6 hours 54 mins, distance: 611 km, cost: 611', 'DistanceMatrix(\"Buffalo\", \"New York\", \"taxi\")': 'taxi, from Buffalo to New York, duration: 6 hours 14 mins, distance: 600 km, cost: 600', 'DistanceMatrix(\"New York\", \"Washington\", \"taxi\")': 'taxi, from New York to Washington, duration: 3 hours 51 mins, distance: 364 km, cost: 364'}\nPlease determine whether the user's request needs clarification. A request needs clarification if the user's intention contains missing or unfeasible details based on the tool parameters and call results in the interaction trajectory. If the user's intention requires clarification, answer \"Yes\"; if it is clear and feasible, answer \"No\".\nAnswer:"
ask_prompts["direct"]["pos_example_agent"] = "Yes.\n\n"

ask_prompts["direct"]["user"] = "Conversation: {conversations}\nInteraction trajectory: {trajectories}\nPlease determine whether the user's request needs clarification. A request needs clarification if the user's intention contains missing or unfeasible details based on the tool parameters and call results in the interaction trajectory. If the user's intention requires clarification, answer \"Yes\"; if it is clear and feasible, answer \"No\".\nAnswer:"

ask_prompts["direct"]["ask_example_user"] = "##### Example\n\nPlease ask the user one clarification question to gather more information about a specific detail. Do not attempt to solve the task.\nQuestion:"
ask_prompts["direct"]["ask_example_agent"] = "To better assist you, could you please specify the total number of days you would like the travel plan to cover for your group of 7 departing from Washington on March 23rd, 2022?\n\n"

ask_prompts["direct"]["ask"] = "Please ask the user one clarification question to gather more information about a specific detail. Do not attempt to solve the task.\nQuestion:"

ask_prompts["conversation_only"]["system"] = f"""Your current task is to determine the user's intentions and satisfy their needs based on the provided conversation between the user and the assistant.""" + null_tips
ask_prompts["conversation_only"]["user"] = "Conversation: {conversations}\nPlease determine whether the user's request needs clarification. A request needs clarification if the user's intention contains missing or unfeasible details. If the user's intention requires clarification, answer \"Yes\"; if it is clear and feasible, answer \"No\".\nAnswer:"
ask_prompts["conversation_only"]["ask"] = ask_prompts["direct"]["ask"]

ask_prompts["proactive"]["system"] = "Your current task is to determine the user's intentions and satisfy their needs based on the provided conversation between the user and the assistant."

ask_prompts["proactive"]["user"] = "Conversation: {conversations}\nBased on the conversation, you have two options: ask a clarifying question or take no action. Choose the appropriate option to formulate your answer, starting with either \"The clarifying question is\" or \"No action should be taken\"." + null_tips

ask_prompts["procot"]["system"] = ask_prompts["proactive"]["system"]

ask_prompts["procot"]["user"] = "Conversation: {conversations}\nBased on the conversation, first determine whether the user's request is ambiguous. A request is ambiguous if it contains missing or unfeasible details. If it is ambiguous, ask a clarifying question. If it is not ambiguous, no action is needed. Your response should start with an analysis of the ambiguity and then conclude with either \"Therefore, the request is not ambiguous. No action should be taken.\" or \"Therefore, the request is ambiguous. The clarifying question is\"." + null_tips

eval_prompts = {}
eval_prompts["system"] = "You are a helpful assistant skilled at evaluating questions."
eval_prompts["user_add"] = 'Please check if the following question exclusively asks for {detail}, rather than {others}. Provide a simple "Yes" or "No" answer.\nQuestion: {question}'
eval_prompts["user_replace"] = 'Please check if the question indicates that the initial {detail} is/are unfeasible and requests changes to the {detail}, rather than {others}. Provide a simple "Yes" or "No" answer.\nQuestion: {question}'
